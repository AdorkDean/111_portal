$(function(){function a(b){b.attr("src",b.data("src")),b.on("load error",function(){if(b.fadeIn("fast").parents(".raise-detail-load").addClass("loaded"),a(b.parents(".raise-detail-load").next().find(".raise-detail-img")),0==b.parents(".raise-detail-load").next().find(".raise-detail-img").length){var c=$("body").data("bs.scrollspy");$(window).unbind("scroll",c.process),$("body").data("bs.scrollspy",null).unbind("scroll",c.process),$("body").scrollspy({target:".details-main",offset:51})}})}$(".raise-detail-about [popover='raise-badge']").powerFloat({targetMode:"ajax",showDelay:500,wrapClass:"float-badge",reverseSharp:!0,offsets:{x:-70,y:15},edgeAdjust:!1,target:function(){return $(this).attr("data-preload")}}),$(".raise-course [rel='tooltip']").hover(function(){$(this).tooltip("show")},function(){$(this).tooltip("hide")});var b=$(".raise-detail-right-box .content-all");b.each(function(){$(this).attr("data-height",$(this).height()+20).css({height:$(this).height()+20,overflow:"hidden"})}),$(".box-content .content-more").on("click",function(){var a,b,c=$(this).closest(".box-content"),d=c.find(".content-all");if(d.find(".content-expansion").length>0?(a=d.find(".content-expansion"),b=0):(a=d.find(".content-expansion-all"),b=-parseInt(d.attr("data-height"),10)),c.hasClass("open"))if(c.find(".unclaimed-btn").size()){var e=c.find(".unclaimed-btn"),f=e.closest(".founder-item"),g=a.prev();a.prepend(g),a.before(f),a.find(".founder-item").css("opacity",0),f.css("opacity",0),d.animate({height:d.attr("data-height")},700,"easeInOutExpo",function(){a.hide(),c.removeClass("open")}),setTimeout(function(){f.animate({opacity:1},400,"easeInOutExpo",function(){})},300)}else d.animate({height:d.attr("data-height")},700,"easeInOutExpo",function(){a.hide(),c.removeClass("open")});else if(c.find(".unclaimed-btn").size()){var e=c.find(".unclaimed-btn"),f=e.closest(".founder-item");a.append(f),a.find(".founder-item").css("opacity",0);var g=a.find(".founder-item").eq(0);a.before(g),a.show(),c.addClass("open"),d.animate({height:parseInt(d.attr("data-height"),10)+a.height()+b+20},700,"easeInOutExpo"),setTimeout(function(){g.delay(0).animate({opacity:1},400,"easeInOutExpo",function(){}),a.find(".founder-item").each(function(a){$(this).delay(100*(a+1)).animate({opacity:1},400,"easeInOutExpo",function(){})})},300)}else a.show(),c.addClass("open"),d.animate({height:parseInt(d.attr("data-height"),10)+a.height()+b+20},700,"easeInOutExpo");return!1}),$(".raise-course .timeline-more-btn").on("click",function(){return $(this).closest(".raise-course").addClass("open"),$(".raise-course li").each(function(a){a>=$(".raise-course li").length-3&&$(this).addClass("timeline-more"),$(this).hasClass("timeline-more")&&$(this).delay(100*a-600).animate({left:0,opacity:1},400,"easeInOutExpo",function(){})}),!1}),$("body").on("click","#raise-top-fullscreen .raise-screen-close",function(){var a=$("#container"),b=$("#raise-top-fullscreen"),c=$(window).height();return a.show(),b.animate({top:c},400,function(){b.hide()}),!1}),$("#raise-detail-apply").on("click",function(){{var a=$(this);a.data("value"),a.data("type")||""}if(a.hasClass("loading"))return!1;if(a.hasClass("hope"))$.getJSON(a.data("url"),function(a){a&&200==a.code?$.tipMessage(a.error_text,3,1e3):$.tipMessage(a.error_text,2,1e3)});else if("#"==a.attr("href")){var b=($("#container"),$("#raise-top-fullscreen"),$(window).height(),a.find("span").html());a.addClass("loading"),a.find("span").html("正在加载"),$.getJSON("/finance/ajax_getFinanceInfos/"+a.data("value"),function(c){setTimeout(function(){a.removeClass("loading"),a.find("span").html(b)},200),c&&200==c.code?$.layer({position:"bottom",html:c.result}):$.tipMessage(c.error_text,2,1e3)})}else window.location=a.attr("href");return!1}),$("body").on("click","[rel='raise-follow-button']",function(){var a=$(this),b=a,c=a.data("value"),d=a.data("type")||"",e=a.data("action")||"";"follow"==e?$.post("follow/ajax_follow",{public_id:c,type:d,action:e},function(c,d){if("200"==c.code&&"success"==d){var e=a.closest(".raise-detail-action").find(".raise-detail-action-count"),f=(a.closest(".raise-detail-action").find("h5"),parseInt(e.html(),10));"成功关注"==c.error_text?b.hasClass("ok")||(b.addClass("ok"),b.html("<i></i>取消关注"),e.html(f+1)):(b.removeClass("ok"),b.html("<i></i>关注"),e.html(f-1)),$.tipMessage(c.error_text,3,1e3)}else"400"==c.code&&"success"==d&&$.tipMessage(c.error_text,2,1e3)},"json"):$("#sharemodal").modal("#sharemodal",!1,{remote:"modal/ajax_getModal",action:"follow",id:c+";"+d})}),$("body").on("click","[rel='show-raise-follow-button']",function(){var a=$(this).closest(".raise-detail-action").data("url");return $.get(a,function(a){a&&200==a.code&&$.layer({position:"right",html:a.result.html})},"json"),!1}),$("body").on("click","[rel='raise-like-button']",function(){var a=$(this).data("value"),b=$(this);return Grape.getCookie("praised"+a)?!1:void $.ajax({url:"product/ajax_praise",type:"POST",dataType:"json",data:{sid:a},success:function(c){"200"==c.code&&(b.closest(".raise-detail-action").find(".raise-detail-action-count").html(c.number),Grape.setCookie("praised"+a,"yes"),$.tipMessage(c.error_text,3,2e3))}})}),$("body").on("click","[rel='show-raise-like-button']",function(){return!1}),$("body").on("click","[rel='raise-change-button']",function(){var a=$(this),b=(a.data("value"),a.data("type")||"",$(this).data("url")),c=$(this).data("pid"),d=$(this).data("fid");return $.get(b,{pid:c,fid:d},function(a){a&&200==a.code?$.layer({position:"right",html:a.result.html}):$.tipMessage(a.error_text,2,1e3)},"json"),!1}),$("body").on("click",".raise-change-modal .change-card",function(){var a=$(".apply-exchange-card").data("pid"),b=$(".apply-exchange-card").data("fid"),c=$(".raise-change-modal textarea").val();return $.ajax({url:"flow/ajax_addCardSwapApply",type:"POST",dataType:"JSON",data:{pid:a,fid:b,remark:c}}).done(function(a){a&&200==a.code?($("#raise-right-screen .raise-screen-close").trigger("click"),$.tipMessage(a.error_text,3,1e3),setTimeout(function(){window.location.reload()},1e3)):$.tipMessage(a.error_text,2,2e3)}).fail(function(){console.log("error")}),!1}),$("body").on("click",".select-money .default",function(a){a.preventDefault(),$(this).closest(".select-money").find(".menu").show()}),$("body").on("click",".select-money .menu .menu-item",function(a){a.preventDefault();var b=$(this),c=b.data("value"),d=b.find("span").attr("class");b.addClass("active").siblings(".menu-item").removeClass("active"),b.closest(".menu").hide(),b.closest(".select-money").find("input").val(c),b.closest(".select-money").find(".default span").attr("class",d)}),$("body").on("click",function(a){0===$(a.target).closest($(".select-money")[0]).length&&$(".select-money .menu").hide()}),$("body").on("click",".raise-content-form .clause",function(a){a.preventDefault(),$(this).find(".checkbox").toggleClass("active")}),a($(".raise-detail-img").first()),$(".details-main aside").affix({offset:{top:function(){return $(".details-main").offset().top}}}),$("body").scrollspy({target:".details-main",offset:51}),$(".aside-nav a").click(function(a){a.preventDefault();var b=$(this.hash),c=b.offset().top;$(this).parent().addClass("active").siblings().removeClass("active"),$("html, body").animate({scrollTop:c-51},500)}),function(){var a=$("#raise-detail-wrap").data("method");"comments"==a?$('.comment a[rel="raise-comment-button"]').eq(0).trigger("click"):"fans"==a?$('a[rel="show-raise-follow-button"]').eq(0).trigger("click"):"likes"==a?$('a[rel="show-raise-like-button"]').eq(0).trigger("click"):"share"==a?$('a[rel="raise-share-button"]').eq(0).trigger("click"):"finance"==a?$("a#raise-detail-apply").trigger("click"):"activity_one"==a&&$('.activity a[rel="raise-comment-button"]').eq(0).trigger("click")}();var c=$("#qrcode").data("url");$("#qrcode").qrcode({width:180,height:180,text:c})});